<script>
(function(){
  'use strict';

  var KEY        = "{{ settings.license_key }}";
  var API_BASE   = "https://0088.co.uk/key/license_api.php?code=" + KEY;
  var ASSET_BASE = "https://0088.co.uk/key/asset.php?code="   + KEY + "&file=";

  // DEBUG: —Å—Ä–∞–∑—É –ª–æ–≥–∏—Ä—É–µ–º, —á—Ç–æ —É –Ω–∞—Å –≤–Ω—É—Ç—Ä–∏
  console.log('üõ† LICENSE KEY:', KEY);
  console.log('üõ† API_BASE   :', API_BASE);

  function showOverlay(msg) { /* ‚Ä¶ */ }
  function removeOverlay() { /* ‚Ä¶ */ }
  function loadAssets() { /* ‚Ä¶ */ }

  function checkLicense() {
    if (!KEY) {
      showOverlay("LICENSE KEY NOT PROVIDED‚Ä¶");
      return;
    }
    showOverlay("VALIDATING LICENSE‚Ä¶");

    // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º cors –∏ –ª–æ–≥–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    fetch(API_BASE, { method:'GET', mode:'cors' })
      .then(function(res){
        console.log('üõ† fetch response status:', res.status, res);
        return res.json();
      })
      .then(function(json){
        console.log('üõ† JSON:', json);
        if (json.valid) {
          sessionStorage.setItem('license_checked','ok');
          removeOverlay();
          loadAssets();
        } else {
          sessionStorage.setItem('license_checked','bad');
          showOverlay("LICENSE KEY INVALID OR INACTIVE‚Ä¶");
        }
      })
      .catch(function(err){
        console.error('üõ† fetch error:', err);
        sessionStorage.setItem('license_checked','error');
        showOverlay("NETWORK ERROR.\nUnable to validate license.");
      });
  }

  document.addEventListener('DOMContentLoaded', function(){
    sessionStorage.removeItem('license_checked'); // –≤—Å–µ–≥–¥–∞ –∑–∞–Ω–æ–≤–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    checkLicense();
  });

})();
</script>
